<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Check-In Pro</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --primary: #6C63FF;
            --text: #ffffff;
            --input-bg: #1e1e24;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 420px;
        }
        h2 { text-align: center; margin: 0 0 20px 0; }
        
        input, select {
            width: 100%; padding: 14px; margin-top: 8px; margin-bottom: 15px;
            background: var(--input-bg); border: none; border-radius: 12px;
            color: #fff; font-size: 16px; outline: none;
        }
        label { font-size: 12px; text-transform: uppercase; color: #b2bec3; font-weight: bold; }
        
        .btn {
            background: var(--primary); color: white; border: none; width: 100%;
            padding: 16px; border-radius: 12px; font-size: 17px; font-weight: 700;
            margin-top: 20px; cursor: pointer;
        }
        
        /* The Invisible Engine */
        iframe { display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>Check-In Pro</h2>

    <iframe name="hidden_iframe" id="hidden_iframe"></iframe>

    <form id="checkinForm" method="POST" target="hidden_iframe">
        
        <label>Guest Name</label>
        <input type="text" name="Guest Name" id="guestName" required>

        <label>Room</label>
        <select name="Room" id="room" required>
            <option value="" disabled selected>Select Room</option>
            <optgroup label="S Series"><option value="S1">S1</option><option value="S2">S2</option><option value="S3">S3</option></optgroup>
            <optgroup label="D Series"><option value="D1">D1</option><option value="D2">D2</option><option value="D3">D3</option></optgroup>
            <optgroup label="C Series"><option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option></optgroup>
        </select>

        <label>Checkout</label>
        <input type="datetime-local" name="Checkout" id="checkout" required>

        <label>Pax</label>
        <select name="Pax" id="pax">
            <option value="1 Pax">1 Pax</option>
            <option value="2 Pax" selected>2 Pax</option>
            <option value="3 Pax">3 Pax</option>
        </select>

        <label>Plan</label>
        <select name="Plan" id="plan">
            <option value="EP Plan">EP Plan</option>
            <option value="CP Plan">CP Plan</option>
            <option value="MAP Plan">MAP Plan</option>
            <option value="AP Plan">AP Plan</option>
        </select>

        <label>Status</label>
        <select name="Status" id="paymentStatus">
            <option value="Received">Received</option>
            <option value="Pending">Pending</option>
        </select>

        <label>Mode</label>
        <select name="Mode" id="paymentMode">
            <option value="Online">Online</option>
            <option value="UPI">UPI</option>
            <option value="Cash">Cash</option>
        </select>

        <button type="button" class="btn" onclick="processCheckIn()">Save & Send</button>
    </form>
</div>

<script>
    // --------------------------------------------------------------------
    // ðŸ”´ PASTE YOUR GOOGLE SCRIPT URL HERE
    const googleUrl = 'https://script.google.com/macros/s/AKfycbwo-_y6yGhAcOSyL0xwB3Z8Xhr44cjt6Sm5R2MVr0y5_U78uNdzQZ7wLBFa9oruK-kSvA/exec';
    // --------------------------------------------------------------------

    // Set form action dynamically
    document.getElementById('checkinForm').action = googleUrl;

    // Date Setup
    window.onload = function() {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(11, 0, 0, 0); 
        const offset = tomorrow.getTimezoneOffset() * 60000;
        document.getElementById('checkout').value = new Date(tomorrow - offset).toISOString().slice(0, 16);
    };

    function processCheckIn() {
        const room = document.getElementById('room').value;
        if(!room) { alert("Select a Room!"); return; }

        // 1. Trigger the "Secret" Form Submission to Google
        // This runs in the background targeting the iframe
        document.getElementById('checkinForm').submit();

        // 2. Prepare WhatsApp Message
        const checkoutRaw = document.getElementById('checkout').value;
        const pax = document.getElementById('pax').value;
        const plan = document.getElementById('plan').value;
        const pStatus = document.getElementById('paymentStatus').value;
        const pMode = document.getElementById('paymentMode').value;
        
        const dateObj = new Date(checkoutRaw);
        const timeStr = dateObj.toLocaleTimeString('en-IN', { hour: 'numeric', minute: '2-digit', hour12: true });

        const message = 
`${room} Checked In
Checkout ${timeStr}
${pax}
${plan}
Payment ${pStatus} ${pMode}`;

        // 3. Open WhatsApp Immediately
        // Because the form submitted to a hidden iframe, this won't be blocked.
        setTimeout(() => {
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }, 100);
    }
</script>

</body>
</html>
